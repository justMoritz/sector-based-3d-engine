/**
 * 
 * Constants and Global Variables 
 * 
 */


// constants
var PI___ = +Math.PI;
var PI_0 = 0.0;
var PIx0_25 = +(PI___ * 0.25);
var PIx05 = +(PI___ * 0.5);
var PIx0_75 = +(PI___ * 0.75);
var PIx1 = PI___;
var PIx1_5 = +(PI___ * 1.5);
var PIx2 = +(PI___ * 2.0);
var I80divPI = 180 / PI___;
var PIdiv4 = PI___ / 4.0;
var PIdiv2 = PI___ / 2.0;
var OneDivPi = 1 /  PI___;

// setup variables
var eScreen;
var eCanvas;
var cCtx;
var eDebugOut;

var nScreenWidth = 480;
var nScreenHeight = 160;

var fFOV = PI___ / 2.5; // (PI___ / 4.0 originally)
var fFOV_div2 = fFOV / 2;
// var fFOV = PI___ / 2.14; // (PI___ / 4.0 originally)
var nLookLimit = 10;

var bUseSkew = true;
var bTexFiltering = true;
var bUseLighting = true;
var bUseFancyLighting = false;
var sPostProcessing = '';

var nDrawWidth = nScreenWidth;
var nRemovePixels = 0;



var bTurnLeft;
var bTurnRight;
var bStrafeLeft;
var bStrafeRight;
var bMoveForward;
var bMoveBackward;
var bJumping;
var bFalling;
var bPaused;
var bRunning = true;
var bPlayerMayMoveForward = true;

var nJumptimer = 0;
var fLooktimer = 0;
var fHeighttimer = 0;
var nNewHeight = 0;


var debugWrite;

var fDepthBufferR = [];
var fLightMap = [];

// defaults
var fPlayerX;
var fPlayerY;
var fPlayerA;
var fPlayerH;
var fDepth = 16.0; // viewport depth

var sLastKnownSector = 0;
var sPlayerSector = 0;
var nSectorCeilingHeight = 1;
var nSectorFloorHeight = 0;

var fPlayerEndX;
var fPlayerEndY;

var fscreenHeightFactor;
var fscreenHeightFactorFloor = nScreenHeight / 2;
var fLocalLooktimer;
var fRayAngleGlob;

var oMap;

var gameRun;

// holds the frames we're going to send to the renderer
var screen = [];



DEBUGMODE = false;
EDITMODE  = false;





const palette95s = [
  [255,0,255], // transparent?
  [0,0,0],
  [128,0,0],
  [0,128,0],
  [128,128,0],
  [0,0,128],
  [128,0,128],
  [0,128,128],
  [192,192,192],
  [192,220,192],
  [166,202,240],
  [42,63,170],
  [42,63,255],
  [42,95,0],
  [42,95,85],
  [42,95,170],
  [42,95,255],
  [42,127,0],
  [42,127,85],
  [42,127,170],
  [42,127,255],
  [42,159,0],
  [42,159,85],
  [42,159,170],
  [42,159,255],
  [42,191,0],
  [42,191,85],
  [42,191,170],
  [42,191,255],
  [42,223,0],
  [42,223,85],
  [42,223,170],
  [42,223,255],
  [42,255,0],
  [42,255,85],
  [42,255,170],
  [42,255,255],
  [85,0,0],
  [85,0,85],
  [85,0,170],
  [85,0,255],
  [85,31,0],
  [85,31,85],
  [85,31,170],
  [85,31,255],
  [85,63,0],
  [85,63,85],
  [85,63,170],
  [85,63,255],
  [85,95,0],
  [85,95,85],
  [85,95,170],
  [85,95,255],
  [85,127,0],
  [85,127,85],
  [85,127,170],
  [85,127,255],
  [85,159,0],
  [85,159,85],
  [85,159,170],
  [85,159,255],
  [85,191,0],
  [85,191,85],
  [85,191,170],
  [85,191,255],
  [85,223,0],
  [85,223,85],
  [85,223,170],
  [85,223,255],
  [85,255,0],
  [85,255,85],
  [85,255,170],
  [85,255,255],
  [127,0,0],
  [127,0,85],
  [127,0,170],
  [127,0,255],
  [127,31,0],
  [127,31,85],
  [127,31,170],
  [127,31,255],
  [127,63,0],
  [127,63,85],
  [127,63,170],
  [127,63,255],
  [127,95,0],
  [127,95,85],
  [127,95,170],
  [127,95,255],
  [127,127,0],
  [127,127,85],
  [127,127,170],
  [127,127,255],
  [127,159,0],
  [127,159,85],
  [127,159,170],
  [127,159,255],
  [127,191,0],
  [127,191,85],
  [127,191,170],
  [127,191,255],
  [127,223,0],
  [127,223,85],
  [127,223,170],
  [127,223,255],
  [127,255,0],
  [127,255,85],
  [127,255,170],
  [127,255,255],
  [170,0,0],
  [170,0,85],
  [170,0,170],
  [170,0,255],
  [170,31,0],
  [170,31,85],
  [170,31,170],
  [170,31,255],
  [170,63,0],
  [170,63,85],
  [170,63,170],
  [170,63,255],
  [170,95,0],
  [170,95,85],
  [170,95,170],
  [170,95,255],
  [170,127,0],
  [170,127,85],
  [170,127,170],
  [170,127,255],
  [170,159,0],
  [170,159,85],
  [170,159,170],
  [170,159,255],
  [170,191,0],
  [170,191,85],
  [170,191,170],
  [170,191,255],
  [170,223,0],
  [170,223,85],
  [170,223,170],
  [170,223,255],
  [170,255,0],
  [170,255,85],
  [170,255,170],
  [170,255,255],
  [212,0,0],
  [212,0,85],
  [212,0,170],
  [212,0,255],
  [212,31,0],
  [212,31,85],
  [212,31,170],
  [212,31,255],
  [212,63,0],
  [212,63,85],
  [212,63,170],
  [212,63,255],
  [212,95,0],
  [212,95,85],
  [212,95,170],
  [212,95,255],
  [212,127,0],
  [212,127,85],
  [212,127,170],
  [212,127,255],
  [212,159,0],
  [212,159,85],
  [212,159,170],
  [212,159,255],
  [212,191,0],
  [212,191,85],
  [212,191,170],
  [212,191,255],
  [212,223,0],
  [212,223,85],
  [212,223,170],
  [212,223,255],
  [212,255,0],
  [212,255,85],
  [212,255,170],
  [212,255,255],
  [255,0,85],
  [255,0,170],
  [255,31,0],
  [255,31,85],
  [255,31,170],
  [255,31,255],
  [255,63,0],
  [255,63,85],
  [255,63,170],
  [255,63,255],
  [255,95,0],
  [255,95,85],
  [255,95,170],
  [255,95,255],
  [255,127,0],
  [255,127,85],
  [255,127,170],
  [255,127,255],
  [255,159,0],
  [255,159,85],
  [255,159,170],
  [255,159,255],
  [255,191,0],
  [255,191,85],
  [255,191,170],
  [255,191,255],
  [255,223,0],
  [255,223,85],
  [255,223,170],
  [255,223,255],
  [255,255,85],
  [255,255,170],
  [204,204,255],
  [255,204,255],
  [51,255,255],
  [102,255,255],
  [153,255,255],
  [204,255,255],
  [0,127,0],
  [0,127,85],
  [0,127,170],
  [0,127,255],
  [0,159,0],
  [0,159,85],
  [0,159,170],
  [0,159,255],
  [0,191,0],
  [0,191,85],
  [0,191,170],
  [0,191,255],
  [0,223,0],
  [0,223,85],
  [0,223,170],
  [0,223,255],
  [0,255,85],
  [0,255,170],
  [42,0,0],
  [42,0,85],
  [42,0,170],
  [42,0,255],
  [42,31,0],
  [42,31,85],
  [42,31,170],
  [42,31,255],
  [42,63,0],
  [42,63,85],
  [255,251,240],
  [160,160,164],
  [128,128,128],
  [255,0,0],
  [0,255,0],
  [255,255,0],
  [0,0,255],
  [255,0,255],
  [0,255,255],
  [255,255,255]
];


const palette95 = [
  [0,0,0],
  [255,255,255],
  [246,246,246],
  [237,237,237],
  [228,228,228],
  [218,218,218],
  [209,209,209],
  [200,200,200],
  [191,191,191],
  [183,183,183],
  [175,175,175],
  [167,167,167],
  [159,159,159],
  [151,151,151],
  [143,143,143],
  [135,135,135],
  [127,127,127],
  [119,119,119],
  [111,111,111],
  [103,103,103],
  [95,95,95],
  [87,87,87],
  [79,79,79],
  [71,71,71],
  [63,63,63],
  [55,55,55],
  [47,47,47],
  [39,39,39],
  [31,31,31],
  [23,23,23],
  [15,15,15],
  [7,7,7],
  [0,0,0],
  [255,127,127],
  [255,95,95],
  [255,63,63],
  [255,0,0],
  [239,0,0],
  [223,0,0],
  [207,0,0],
  [191,0,0],
  [175,0,0],
  [159,0,0],
  [143,0,0],
  [127,0,0],
  [111,0,0],
  [95,0,0],
  [71,0,0],
  [55,0,0],
  [255,219,192],
  [255,203,151],
  [255,185,117],
  [255,168,85],
  [255,151,54],
  [255,134,25],
  [255,117,0],
  [236,105,0],
  [221,94,0],
  [208,88,0],
  [196,79,0],
  [181,68,0],
  [159,56,0],
  [138,41,0],
  [129,32,0],
  [121,24,0],
  [235,219,87],
  [215,187,67],
  [195,155,47],
  [175,123,31],
  [155,91,19],
  [135,67,7],
  [117,41,0],
  [85,0,0],
  [255,255,79],
  [255,255,0],
  [227,217,15],
  [201,187,14],
  [170,155,11],
  [136,120,9],
  [112,96,7],
  [90,73,5],
  [255,255,207],
  [255,255,175],
  [255,255,143],
  [255,255,115],
  [235,222,129],
  [208,194,128],
  [183,169,119],
  [150,131,93],
  [222,255,168],
  [199,228,148],
  [173,200,128],
  [149,173,107],
  [124,146,88],
  [100,119,68],
  [74,90,48],
  [50,63,29],
  [119,255,79],
  [112,240,75],
  [105,224,70],
  [97,208,65],
  [90,192,60],
  [82,176,55],
  [75,160,50],
  [67,144,45],
  [60,128,40],
  [53,112,35],
  [45,96,30],
  [38,80,25],
  [30,64,20],
  [23,48,15],
  [15,32,10],
  [7,15,4],
  [0,255,0],
  [0,223,0],
  [0,191,0],
  [0,159,0],
  [0,127,0],
  [0,95,0],
  [0,63,0],
  [0,45,0],
  [183,251,231],
  [102,247,203],
  [21,242,176],
  [11,210,151],
  [3,177,128],
  [2,147,107],
  [2,115,84],
  [1,86,63],
  [206,250,255],
  [166,241,255],
  [117,231,255],
  [87,213,255],
  [79,199,255],
  [71,185,255],
  [55,165,255],
  [32,138,225],
  [24,111,182],
  [21,83,134],
  [14,53,86],
  [7,30,48],
  [116,209,201],
  [66,179,179],
  [23,136,136],
  [0,95,95],
  [231,231,255],
  [198,198,255],
  [173,173,255],
  [140,140,255],
  [115,115,255],
  [82,82,255],
  [49,49,255],
  [24,24,255],
  [0,0,255],
  [0,0,223],
  [0,0,196],
  [0,0,172],
  [0,0,149],
  [0,0,128],
  [0,0,102],
  [0,0,82],
  [216,183,255],
  [199,153,255],
  [173,106,255],
  [152,68,255],
  [127,22,255],
  [107,0,238],
  [91,0,201],
  [72,0,159],
  [51,0,113],
  [36,0,81],
  [151,151,213],
  [119,119,187],
  [84,84,167],
  [65,65,131],
  [46,46,92],
  [33,34,78],
  [255,202,255],
  [255,170,255],
  [255,138,255],
  [255,106,255],
  [255,74,255],
  [255,0,255],
  [221,0,221],
  [191,0,191],
  [162,0,162],
  [121,0,121],
  [85,0,85],
  [53,0,53],
  [197,232,0],
  [167,202,4],
  [140,168,11],
  [108,124,18],
  [207,127,207],
  [183,111,183],
  [159,95,159],
  [135,79,135],
  [111,63,111],
  [87,47,87],
  [64,32,64],
  [43,21,43],
  [255,196,224],
  [255,153,192],
  [245,112,165],
  [221,87,140],
  [199,61,116],
  [177,52,102],
  [157,47,91],
  [133,39,77],
  [255,230,219],
  [255,191,191],
  [255,159,159],
  [225,133,133],
  [204,113,113],
  [194,99,99],
  [181,83,83],
  [167,63,63],
  [255,207,179],
  [255,193,158],
  [255,183,139],
  [247,171,123],
  [239,163,115],
  [227,151,103],
  [215,139,91],
  [207,131,83],
  [191,123,75],
  [179,115,71],
  [171,111,67],
  [163,107,63],
  [155,99,59],
  [143,95,55],
  [135,87,51],
  [127,83,47],
  [119,79,43],
  [107,71,39],
  [95,67,35],
  [83,63,31],
  [75,55,27],
  [63,47,23],
  [51,43,19],
  [43,35,15],
  [191,167,143],
  [175,152,128],
  [159,137,113],
  [146,125,101],
  [134,114,90],
  [126,106,82],
  [117,98,74],
  [109,90,66],
  [101,83,59],
  [93,75,51],
  [0,0,0],
  [0,0,0],
  [0,0,0],
  [0,0,0],
  [0,0,0],
  [0,0,0],
];