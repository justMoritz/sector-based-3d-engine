<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sprite CharMap â†’ RGB Converter</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 150px; font-family: monospace; margin-top: 10px; }
    button { margin-top: 10px; }
    canvas { border: 1px solid #ccc; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>Sprite Converter</h1>

  <h3>1. CharMap (JSON format)</h3>
  <textarea id="charMapInput">
  {
    ".": [0,0,0],
    "*": [22,22,22],
    "7": [100,240,100],
    "#": [242,242,252]
  }
    
  </textarea>

  <h3>2. Sprite Block</h3>
  <textarea id="spriteInput">const obetrl =
"..********......"+
"..*777777*......"+
"..*777777*......"+
"...*77777*......"+
"...*777777****.."+
"....*77777*777*."+
"...*77****77777*"+
"..*7##*###*777*."+
"..*7#*####*777*."+
".*7#**##*#*77*.."+
".*7##*####*77*.."+
".*7##*###*777*.."+
"..*77#***#777*.."+
".*7777####***..."+
"*777777*##**...."+
"*77777*7##*....."+
"*777**77#7**...."+
".*7*77777*77*..."+
"..****77#*7***.."+
".....**7#***7*.."+
"....*7###*7*7*.."+
"...*77##7*77**.."+
"...*7##7**7*7*.."+
"....*#7777**...."+
"...**#**7*......"+
"..**77*77**....."+
"..*777777*......"+
"..********......";</textarea>

  <button id="convertBtn">Convert to RGB Array</button>

  <h3>Output</h3>
  <textarea id="output" readonly></textarea>

  <h3>Preview</h3>
  <canvas id="preview"></canvas>

<script>
document.getElementById('convertBtn').addEventListener('click', () => {
  try {
    const charMap = JSON.parse(document.getElementById('charMapInput').value);

    let spriteText = document.getElementById('spriteInput').value;
    spriteText = spriteText
      .replace(/const\s+\w+\s*=\s*/g, "")
      .replace(/[+";]/g, "")
      .trim();

    const lines = spriteText.split("\n").map(l => l.trim()).filter(l => l.length > 0);
    const width = lines[0].length;
    const height = lines.length;

    const rgbArray = [];
    for (let line of lines) {
      for (let ch of line) {
        rgbArray.push(charMap[ch] || [0,0,0]); // fallback: black
      }
    }

    document.getElementById('output').value = JSON.stringify(rgbArray);

    // --- draw preview ---
    const scale = 10; // pixel scale
    const canvas = document.getElementById('preview');
    canvas.width = width * scale;
    canvas.height = height * scale;
    const ctx = canvas.getContext('2d');

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const [r,g,b] = rgbArray[y*width + x];
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fillRect(x*scale, y*scale, scale, scale);
      }
    }
  } catch (e) {
    alert("Error: " + e.message);
  }
});
</script>
</body>
</html>
