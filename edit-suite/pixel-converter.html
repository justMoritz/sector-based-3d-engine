<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2-Char Sprite Converter</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    textarea { width: 100%; height: 150px; font-family: monospace; margin-top: 10px; }
    input { width: 60px; margin-left: 10px; }
    button { margin-top: 10px; }
    canvas { border: 1px solid #ccc; margin-top: 10px; image-rendering: pixelated; }
  </style>
</head>
<body>
  <h1>2-Char Sprite Converter</h1>

  <h3>1. Sprite Source String</h3>
  <textarea id="spriteInput">".m.m*7#m...."</textarea>

  <div>
    Width: <input id="widthInput" type="number" value="18">
    Height: <input id="heightInput" type="number" value="25">
  </div>

  <button id="convertBtn">Convert & Preview</button>

  <h3>Output RGB Array</h3>
  <textarea id="output" readonly></textarea>

  <canvas id="preview" width="180" height="250"></canvas>

<script>
// ----- your lookup table -----
const texelLookupTable = {
  "#000000": ['.', 'm'], // Black
  "#424242": ['o', 'm'], // Grays
  "#858585": ['*', 'm'],
  "#c8c8c8": ['7', 'm'],
  "#ffffff": ['#', 'm'],

  "#201888": ['o', 'b'], // Blues
  "#2038e8": ['*', 'b'],
  "#5890f8": ['7', 'b'],
  "#c0d0f8": ['#', 'b'],

  "#880070": ['o', 'p'], // Pinks
  "#b800b8": ['*', 'p'],
  "#f078f8": ['7', 'p'],
  "#f8b8f8": ['#', 'p'],

  "#a00000": ['o', 'r'], // Reds
  "#d82842": ['*', 'r'],
  "#f87060": ['7', 'r'],
  "#f8b8b0": ['#', 'r'],

  "#724007": ['o', 'o'], // Oranges
  "#887000": ['*', 'o'],
  "#c7b41c": ['7', 'o'],
  "#dccf70": ['#', 'o'],

  "#005000": ['o', 'g'], // Greens
  "#00a800": ['*', 'g'],
  "#48d848": ['7', 'g'],
  "#a8f8b8": ['#', 'g'],

  "#183858": ['o', 't'], // Teals
  "#008088": ['*', 't'],
  "#00e8d9": ['7', 't'],
  "#98f8f0": ['#', 't'],
};

// ----- build reverse lookup: "pair" -> [r,g,b] -----
const reverseLookup = {};
for (const hex in texelLookupTable) {
  const pair = texelLookupTable[hex].join("");
  const r = parseInt(hex.substr(1,2),16);
  const g = parseInt(hex.substr(3,2),16);
  const b = parseInt(hex.substr(5,2),16);
  reverseLookup[pair] = [r,g,b];
}

// ----- converter -----
document.getElementById('convertBtn').addEventListener('click', () => {
  try {
    let raw = document.getElementById('spriteInput').value.trim();
    const width = parseInt(document.getElementById('widthInput').value, 10);
    const height = parseInt(document.getElementById('heightInput').value, 10);

    const neededPairs = width * height;
    const providedPairs = raw.length / 2;

    if (providedPairs !== neededPairs) {
      alert(`String has ${providedPairs} pairs but width*height=${neededPairs}`);
      return;
    }

    const rgbArray = [];
    for (let i=0; i<raw.length; i+=2) {
      const pair = raw.slice(i,i+2);
      rgbArray.push(reverseLookup[pair] || [0,0,0]);
    }

    document.getElementById('output').value = JSON.stringify(rgbArray);

    // preview
    const canvas = document.getElementById('preview');
    const scale = 10;
    canvas.width = width * scale;
    canvas.height = height * scale;
    const ctx = canvas.getContext('2d');

    for (let y=0; y<height; y++) {
      for (let x=0; x<width; x++) {
        const idx = y*width + x;
        const [r,g,b] = rgbArray[idx];
        ctx.fillStyle = `rgb(${r},${g},${b})`;
        ctx.fillRect(x*scale, y*scale, scale, scale);
      }
    }
  } catch (err) {
    alert("Error: " + err.message);
  }
});
</script>
</body>
</html>
